(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})}};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);const t=require("express");var r=e.n(t);const n=require("cors");var a=e.n(n);const o=require("mongoose");var s=e.n(o);const c=require("@babel/runtime/helpers/defineProperty");var i=e.n(c);const u=require("@babel/runtime/helpers/asyncToGenerator");var l=e.n(u);const p=require("@babel/runtime/regenerator");var f=e.n(p);const d=require("@babel/runtime/helpers/classCallCheck");var v=e.n(d);const h=require("@babel/runtime/helpers/createClass");var b=e.n(h);const m=require("chalk");var y=e.n(m),g=console.log;const w=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return g(y().red.bold("".concat(t||"ERROR"),e))},O=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"*";return g(y().gray.bold("".concat(t),e))};var j=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"GET";v()(this,e),this.response=t,this.route=r,this.method=n}return b()(e,[{key:"json",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:200,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"ok";return e>300?w("[".concat(this.method.toUpperCase(),"] /").concat(this.route," : ").concat(r),e):O("[".concat(this.method.toUpperCase(),"] /").concat(this.route," : Data sent with success"),e),this.response.status(e).json({status:e,message:r,data:t})}}]),e}(),k=function(){function e(t,r){v()(this,e),this.route=t,this.method=r}return b()(e,[{key:"json",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"ok";return t>300?w("[WS:".concat(this.method.toUpperCase(),"] /").concat(this.route," : ").concat(n),t):O("[WS:".concat(this.method.toUpperCase(),"] /").concat(this.route," : Data sent with success"),t),e.send(JSON.stringify({status:t,message:n,data:r}))}}],[{key:"jsonBroadCast",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"ok",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"GET";this.method=s,t.clients.forEach((function(t){new e(o,s).json(t,r,n,a)}))}}]),e}();const x=require("@babel/runtime/helpers/typeof");var P=e.n(x);const S=require("@babel/runtime/helpers/slicedToArray");var D=e.n(S);function T(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function E(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?T(Object(r),!0).forEach((function(t){i()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):T(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var q=s().Schema,I={type:String,trim:!0,validate:[function(e){return/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(e)},"Please provide a valid email address"],match:[/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/,"Please fill a valid email address"]},N={type:String,match:/.{4,}/},A={STRING:["minlength","maxlength","match","enum","uppercase","lowercase","trim","required","validate","default"],NUMBER:["min","max","enum","required","validate","default"],DATE:["min","max","required","validate","default"]};function C(e){var t=e.type,r={};if("Email"!==t&&"Text"!==t&&t!==String&&t!==Boolean||(r=E(E({},e),U(t))),"Password"===t||"File"===t||t===Date){var n=t===Date?"DATE":"STRING";r=E(E({},r=U(t)),function(e,t){var r,n,a={},o=Object.keys(e);return(r=o,n=A[t],r.filter((function(e){return n.includes(e)}))).forEach((function(t){a[t]=e[t]})),a}(e,n))}return t===s().Types.ObjectId&&(r=E({},e)),r}function U(e){var t={};switch(e){case"Text":t={type:String};break;case"Email":t=I;break;case"Password":t=N;break;case"File":t={type:String};break;case Number:t={type:Number};break;case Date:t={type:Date};break;case Boolean:t={type:Boolean};break;case String:t={type:String}}return t}function B(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function R(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?B(Object(r),!0).forEach((function(t){i()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):B(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const _=function(e,t){var n=r().Router(),a=function(e){return s().model(e.name,function(e){for(var t={},r=0,n=Object.entries(e);r<n.length;r++){var a=D()(n[r],2),o=a[0],s=a[1];t=null===s||"object"!==P()(s)||Array.isArray(s)?Array.isArray(s)?E(E({},t),{},i()({},o,s)):E(E({},t),{},i()({},o,U(s))):E(E({},t),{},i()({},o,C(s)))}return new q(t)}(e.schema))}(e),o=function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"get",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"ok";k.jsonBroadCast(t,n,a,o,e.name,r)};return n.get("/",function(){var t=l()(f().mark((function t(r,n){var o,s;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=new j(n,e.name),t.prev=1,t.next=4,a.find(R({},r.query));case 4:s=t.sent,o.json(200,s),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(1),o.json(500,null,"Unable to read data");case 11:case"end":return t.stop()}}),t,null,[[1,8]])})));return function(e,r){return t.apply(this,arguments)}}()),n.get("/:id",function(){var t=l()(f().mark((function t(r,n){var o,s;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=new j(n,e.name+"/"+r.params.id),t.prev=1,t.next=4,a.findById(r.params.id);case 4:(s=t.sent)?o.json(200,s):o.json(404,null,"Resource not found."),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(1),o.json(500,null,t.t0.message);case 11:case"end":return t.stop()}}),t,null,[[1,8]])})));return function(e,r){return t.apply(this,arguments)}}()),n.post("/",function(){var t=l()(f().mark((function t(r,n){var o,s;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=new j(n,e.name+"/"+r.params.id),t.prev=1,s=new a(R({},r.body)),console.log(r.body,s),t.next=6,s.save();case 6:o.json(201,s,"Item created!"),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(1),o.json(201,null,t.t0.message);case 12:case"end":return t.stop()}}),t,null,[[1,9]])})));return function(e,r){return t.apply(this,arguments)}}()),n.put("/:id",function(){var e=l()(f().mark((function e(t,r){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return delete t.body._id,e.prev=1,e.next=4,a.updateOne({_id:t.params.id},R({},t.body));case 4:r.status(200).json({message:"Item Updated!"}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),r.status(422).json(e.t0);case 10:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t,r){return e.apply(this,arguments)}}()),n.delete("/:id",function(){var e=l()(f().mark((function e(t,r){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a.deleteOne({_id:t.params.id});case 3:r.status(200).json({message:"Item deleted!"}),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),r.status(422).json(e.t0);case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t,r){return e.apply(this,arguments)}}()),n.ws("/post",(function(t,r){t.on("message",function(){var t=l()(f().mark((function t(r){var n;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n=new a(JSON.parse(r)),t.next=4,n.save();case 4:console.log(n),o("post",200,{route:e.name,posted:n}),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),o("post",500,null,t.t0.message);case 11:case"end":return t.stop()}}),t,null,[[0,8]])})));return function(e){return t.apply(this,arguments)}}())})),n.ws("/put",(function(t,r){t.on("message",function(){var t=l()(f().mark((function t(r){var n,s,c;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n=JSON.parse(r),s=n.id,delete n.id,t.next=6,a.updateOne({_id:s},n);case 6:c=t.sent,o("put",200,{route:e.name,updated:c}),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(0),o("put",422,null,t.t0.message);case 13:case"end":return t.stop()}}),t,null,[[0,10]])})));return function(e){return t.apply(this,arguments)}}())})),n.ws("/delete",(function(t,r){t.on("message",function(){var t=l()(f().mark((function t(r){return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,a.deleteOne({_id:JSON.parse(r).id});case 3:o("delete",200,{route:e.name,deletedId:JSON.parse(r).id}),t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),o("delete",422,null,t.t0.message);case 9:case"end":return t.stop()}}),t,null,[[0,6]])})));return function(e){return t.apply(this,arguments)}}())})),n};e.g.Text="Text",e.g.Email="Email",e.g.Password="Password",e.g.File="File",e.g.Date=Date,e.g.Number=Number,e.g.Boolean=Boolean,e.g.ObjectId=s().Types.ObjectId;const F={users:{email:Email,password:Password,name:{required:!0,type:Text}},posts:{author:{type:ObjectId,ref:"users"},message:Text,at:Date,likes:Number}};function G(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var M=Object.entries(F).map((function(e){return{name:e[0],schema:e[1]}}));function J(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function W(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?J(Object(r),!0).forEach((function(t){i()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):J(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function $(e){var t={},r={Date,Number,Boolean,ObjectId:s().Types.ObjectId};for(var n in e){var a=!1;for(var o in r){if(e[n]===r[o]){t[n]=o,a=!0;break}if(e[n].type&&e[n].type===r[o]){t[n]=W(W({},e[n]),{},{type:o}),a=!0;break}}a||(t[n]=e[n])}return t}const z=require("dotenv");var H=e.n(z);const K=require("express-ws");var L=e.n(K);H().config();var Q=r()(),V=L()(Q).getWss();Q.use(a()()),Q.use(r().json()),s().connect(process.env.MONGO_URI,{useNewUrlParser:!0,useUnifiedTopology:!0,useFindAndModify:!1,useCreateIndex:!0}).catch((function(e){return w("Unable to connect to Mongo database")})),function(e,t){var r,n=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return G(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?G(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw o}}}}(M);try{for(n.s();!(r=n.n()).done;){var a=r.value;e.use("/api/"+a.name,_(a,t))}}catch(e){n.e(e)}finally{n.f()}}(Q,V),function(e){var t=r().Router();t.get("/",(function(e,t){new j(t,"schema").json(200,function(e){var t={};for(var r in e)t[r]=$(e[r]);return t}(F))})),t.get("/:name",(function(e,t){var r=e.params.name,n=new j(t,"schema/"+r);r in F?n.json(200,F[r]):n.json(404,null,"The collection name provided does not exists")})),e.use("/api/schema",t)}(Q);var X=process.env.PORT||4300;Q.listen(X,(function(e){return t="Server is started",g(y().green("[SUCCESS]",t));var t}))})();
//# sourceMappingURL=main.js.map